<!DOCTYPE html>
<html>
  <head>
    <title>Test</title>
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
	<script src="http://code.highcharts.com/highcharts.js"></script>
	<script src="http://code.highcharts.com/highcharts-more.js"></script>
	<script src="http://code.highcharts.com/modules/exporting.js"></script>
	<script src="/socket.io/socket.io.js"></script>
	
    <script>
    	var chart;
    	$(function () {
		    chart = new Highcharts.Chart({
		    
		        chart: {
		            renderTo: 'container',
		            type: 'gauge',
		            alignTicks: false,
		            plotBackgroundColor: null,
		            plotBackgroundImage: null,
		            plotBorderWidth: 0,
		            plotShadow: false
		        },
		    
		        title: {
		            text: 'Clapometer'
		        },
		        
		        pane: {
		            startAngle: -150,
		            endAngle: 150
		        },            
		    
		        yAxis: [{
		            min: 0,
		            max: 200,
		            lineColor: '#339',
		            tickColor: '#339',
		            minorTickColor: '#339',
		            offset: -25,
		            lineWidth: 2,
		            labels: {
		                distance: -20,
		                rotation: 'auto'
		            },
		            tickLength: 5,
		            minorTickLength: 5,
		            endOnTick: false
		        }, {
		            min: 0,
		            max: 124,
		            tickPosition: 'outside',
		            lineColor: '#933',
		            lineWidth: 2,
		            minorTickPosition: 'outside',
		            tickColor: '#933',
		            minorTickColor: '#933',
		            tickLength: 5,
		            minorTickLength: 5,
		            labels: {
		                distance: 12,
		                rotation: 'auto'
		            },
		            offset: -20,
		            endOnTick: false
		        }],
		    
		        series: [{
		            name: 'Enthusiasm',
		            data: [0],
		            dataLabels: {
		                
		                backgroundColor: {
		                    linearGradient: {
		                        x1: 0,
		                        y1: 0,
		                        x2: 0,
		                        y2: 1
		                    },
		                    stops: [
		                        [0, '#DDD'],
		                        [1, '#FFF']
		                    ]
		                }
		            },
		            tooltip: {
		                valueSuffix: ' km/h'
		            }
		        }]
		    
		    },
		     function(chart) {
		        setInterval(function() {
		            var point = chart.series[0].points[0];
		            var newVal;
		    
		            if (point.y > 0) {
		                newVal = point.y - 2;
		            }
		    
		            point.update(newVal);
		    
		        }, 100);
		    
		    });
		});
    	
    	var socket = io.connect('http://localhost:3000');
		socket.emit('event', '<%= event %>');
		socket.on('message', function (data) {
			var point = chart.series[0].points[0]
			var newVal;
     
	        if (point.y < 200) {
	            newVal = point.y + parseInt(data.count);
	        }
	
	        point.update(newVal);
		});
    	
	</script>
  </head>
  <body>
    <div id="container" style="min-width: 400px; height: 500px; margin: 0 auto"></div>
  </body>
</html>